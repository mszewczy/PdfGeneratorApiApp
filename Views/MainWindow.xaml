<Window x:Class="PdfGeneratorApiApp.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:PdfGeneratorApiApp.ViewModels"
        xmlns:models="clr-namespace:PdfGeneratorApiApp.Models"
        xmlns:converters="clr-namespace:PdfGeneratorApiApp.Converters"
        xmlns:syncfusion="clr-namespace:Syncfusion.Windows.PdfViewer;assembly=Syncfusion.PdfViewer.WPF"
        xmlns:dd="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.Wpf.DragDrop"
        mc:Ignorable="d"
        Title="PDF Generator (DynamicPDF.API)" Height="800" Width="1200">
    <Window.DataContext>
        <viewModels:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InvertBooleanConverter x:Key="InvertBooleanConverter"/>

        <HierarchicalDataTemplate DataType="{x:Type models:TocItem}" ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding DisplayText}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding Url, StringFormat=' ({0})'}" FontStyle="Italic" Foreground="Gray" Margin="5,0,0,0" VerticalAlignment="Center"/>
            </StackPanel>
        </HierarchicalDataTemplate>

        <Style TargetType="TreeViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="450" MinWidth="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <DockPanel Grid.Column="0" Margin="0,0,10,0">
            <TextBlock DockPanel.Dock="Top" Text="Hierarchia Zakładek" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>

            <StackPanel DockPanel.Dock="Bottom" Margin="0,10,0,0">
                <GroupBox Header="Dodaj nowy element (poziom główny)" Padding="5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="URL:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Text="{Binding NewItemUrl, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="1" Margin="0,2"/>
                        <TextBlock Text="Opis:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox Text="{Binding NewItemDisplayText, UpdateSourceTrigger=PropertyChanged}" Grid.Row="1" Grid.Column="1" Margin="0,2"/>
                    </Grid>
                </GroupBox>
                <Button Content="Dodaj element" Command="{Binding AddItemCommand}" Margin="0,10,0,0"/>

                <GroupBox Header="Opcje generowania" Padding="5" Margin="0,15,0,0">
                    <StackPanel>
                        <RadioButton Content="Spis treści na początku dokumentu" IsChecked="{Binding IsTocAtStart}" GroupName="TocPosition"/>
                        <RadioButton Content="Spis treści na końcu dokumentu" GroupName="TocPosition"/>
                        <CheckBox Content="Dołącz tabelę kodów QR dla linków" IsChecked="{Binding GenerateQrCodeTable}" Margin="0,10,0,0"/>
                    </StackPanel>
                </GroupBox>
                <Button Content="Generuj PDF" Command="{Binding GeneratePdfAsyncCommand}" IsEnabled="{Binding IsGenerating, Converter={StaticResource InvertBooleanConverter}}" FontWeight="Bold" Padding="10" Margin="0,20,0,0"/>
                <ProgressBar IsIndeterminate="True" Height="10" Margin="0,5,0,0" Visibility="{Binding IsGenerating, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StackPanel>

            <TreeView ItemsSource="{Binding TocItems}"
                      dd:DragDrop.IsDragSource="True"
                      dd:DragDrop.IsDropTarget="True"
                      dd:DragDrop.DropHandler="{Binding}"/>
        </DockPanel>

        <Border Grid.Column="1" BorderBrush="LightGray" BorderThickness="1">
            <syncfusion:PdfViewerControl x:Name="pdfViewer"/>
        </Border>
    </Grid>
</Window>
